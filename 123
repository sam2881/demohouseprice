def apply_explode(df, paths):
    exploded_dfs = []
    for path in paths:
        parts = path.split('.')
        for i in range(len(parts)):
            sub_path = '.'.join(parts[:i + 1])
            exploded_col_name = camel_to_snake(parts[i] + "_exploded")
            if "exploded" not in sub_path:
                df = df.withColumn(exploded_col_name, explode_outer(col(sub_path)))
        exploded_dfs.append((exploded_col_name, sub_path))
    return df, exploded_dfs

def generate_select_expr(exploded_dfs):
    select_expr = []
    for exploded_col_name, path in exploded_dfs:
        select_expr.append(col(exploded_col_name).alias(camel_to_snake(path.replace('.', '_'))))
    return select_expr

# After exploding
df, exploded_info = apply_explode(df, explosion_paths)

# Generate select expressions based on exploded columns
select_expressions = generate_select_expr(exploded_info)
df_final = df.select(*select_expressions)

df_final.show(truncate=False)
