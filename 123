# Print the schema to confirm the structure
df.printSchema()

# If using a notebook or an interactive environment, display a few rows to understand the structure
df.show(truncate=False)

# Assuming 'individualCoreIdentity.individualDemographic' is an array of structures and you exploded it:
df = df.withColumn("individualDemographic_exploded", explode_outer(col("individualCoreIdentity.individualDemographic")))

# After explosion, print schema again to verify new structure
df.printSchema()

# Selecting the 'createdBy' from the exploded array
try:
    df.select(col("individualDemographic_exploded.createdBy").alias("created_by")).show(truncate=False)
except Exception as e:
    print("Error in selecting column:", e)

# If the above step fails, verify column names and adjust accordingly.
